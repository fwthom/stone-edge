<div class=back-results>
  <%= link_to "< Retourner à la recherche", stones_path %>
</div>

<div class="container">


<div class="show-big-container", data-controller="datepicker">
  <div class="show-container">
    <div class="left-stone-container">
      <div>
        <div class="align-center">
          <% if @stone.photo.attached? %>
            <%= cl_image_tag @stone.photo.key, class: "stone-show-card-img" %>
          <% else %>
            <%= cl_image_tag "development/17n6kwpi22xr4dlapk6w6t56qudu", class: "stone-show-card-img", alt: "Image par défaut" %>
          <% end %>
        </div>
          <div>
            <h1>Découvrez <strong><%= @stone.name %></strong></h1>
            <h4><%= @stone.category.name %></h4>
            <p><%= @stone.category.properties %></p>
            <p><%= @stone.backstory %></p>
          </div>
        </div>
        <div class="show-mail">
          <h2>Rencontrez le propriétaire :</h2>
          <p><%= @stone.user.email %></p>
      </div>
    </div>

    <div class="right-stone-container">
        <% if @marker != nil %>
        <h2>Localisation</h2>
          <div class="map-stone-show">
              <div style="width: 100%; height: 100%;"
                data-controller="map"
                data-map-markers-value="<%= @marker.to_json %>"
                data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
              </div>
            </div>
          <% end %>



            <% if @stone.user == current_user %>
            <div>

              <div class="d-flex align-items-center justify-content-between">
                <h2>Modifier ma pierre </h2>
                <div class="d-flex align-items-center justify-content-between">
                  <div>
                    <%= link_to edit_stone_path(@stone) do %>
                      <i class="fa-regular fa-pen-to-square", style:"width:30px;color:black"></i>
                    <% end  %>
                  </div>
                  <div id="DeleteEtid" style="width:30px">
                    <%= link_to stone_path(@stone), data: { turbo_method: :delete, turbo_confirm: 'Vous voulez vraiment supprimer cette pierre ?' } do %>
                      <i class="fa-solid fa-xmark", style:"width:30px"></i>
                    <% end %>
                  </div>
                </div>
              </div>

              <h2>Bookings de cette pierre : </h2>


              <ul class="list-group">
              <% @stone.bookings.each do |booking| %>
                <li class="d-flex justify-content-between align-items-center">
                  <%= link_to stone_path(@stone), class: "text-decoration-none d-flex" do %>
                  <%# <span class="badge bg-secondary"><%= @stone.category.try(:name) || "No Category" %>
                    <p>Réservation par <%= booking.user.first_name %> du <%= booking.start_date %> au <%= booking.end_date %></p>
                    <p class="booking-button"><%= booking.status %></p>
                  <% end %>
                </li>
              <% end %>
            </ul>


            </div>
            <% end %>

        <% unless @stone.user == current_user %>
        <h2>Réservation</h2>
        <div class="cal-stone-show">
        <div class="form-wrapper"
            data-controller="booking"
            data-booking-start-date-value="<%= params[:start_date] %>"
            data-booking-end-date-value="<%= params[:end_date] %>"
            data-booking-price-value="<%= Stone.find(params[:id]).daily_price %>">
          <div id="price">
            <h3 data-booking-target="priceShow"></h3>
          </div>

           <div data-action="change->booking#updatePrice">
            <%= simple_form_for [@stone, @booking] do |f| %>
              <%= f.input :start_date, as: :string,
                                      required: false,
                                      label: false,
                                      input_html: { class: "d-none", id: "range_start", data: { datepicker_target: "start", booking_target: "startDate" } } %>
              <%= f.input :end_date, as: :string,
                                    required: false,
                                    label: false,
                                    input_html: { class: "d-none", id: "range_end", data: { datepicker_target: "end", booking_target: "endDate" } } %>
              <%= f.button :submit, "Réserver cette pierre", class: "btn btn-primary" %>
            <% end %>
          </div>
        <% end %>

        <div data-datepicker-target="dateForm"
             data-bookings="<%= @bookings_dates.to_json %>">
        </div>
    </div>
    </div>
  </div>


</div>
</div>
</div>
